<!-- jquery-->
<html>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> -->
<!-- instascan-->
<!-- <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js" ></script> -->
<!-- <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>  -->
<script src="face-api.min.js"></script>
<style>
	body {
		margin:0;
		display:flex;
		justify-content:center;
		align-items:center;
	}
	canvas {
		position:absolute;
	}
</style>
<body> 
<video id="video" muted autoplay="true" ></video>
</body>
<script type="text/javascript">
const modelLocation = 'models';
Promise.all([
	faceapi.nets.tinyFaceDetector.loadFromUri(modelLocation),
	faceapi.nets.faceLandmark68Net.loadFromUri(modelLocation),
	faceapi.nets.faceRecognitionNet.loadFromUri(modelLocation),
	faceapi.nets.faceExpressionNet.loadFromUri(modelLocation),
	faceapi.nets.ageGenderNet.loadFromUri(modelLocation)
])

const video = document.getElementById('video');  
const errorMsgElement = document.getElementById('span#ErrorMsg');
//config video
const constraints = {
	audio: true,
	video:{
		width: 1024, height: 600
	}
};
//access webcam
async function init(){
	try{
		const stream = await navigator.mediaDevices.getUserMedia(constraints);
		video.srcObject = stream;
		
		video.addEventListener('play', () => {
			const canvas = faceapi.createCanvasFromMedia(video)
			document.body.append(canvas)
			const displaySize = {width: constraints.video.width , height: constraints.video.height}
			faceapi.matchDimensions(canvas, displaySize)
			
			setInterval( async () => {
					const detection = await faceapi.detectAllFaces(video,
					new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceExpressions()
					console.log(detection)
					const resizedDetection = faceapi.resizeResults(detection , displaySize)
					canvas.getContext('2d').clearRect(0,0,canvas.width , canvas.height )
					faceapi.draw.drawDetections(canvas, resizedDetection)
					faceapi.draw.drawFaceLandmarks(canvas, resizedDetection)
				}, 500)
		})
		
	}catch(e){
		errorMsgElement.innerHTML = `navigator.getUserMedia.error:${e.toString()}`;
	}
} 
//load init
init(); 

</script>
</html>
